import e from"css-tree/parser";import t from"css-tree/walker";import{calculate as i}from"@bramus/specificity/core";function r(e,t){return e.charCodeAt(t)}function n(e,t){return t>=65&&t<=90&&(t|=32),e===t}function o(e,t){let i=e.length;if(i!==t.length)return!1;for(let o=0;o<i;o++)if(!1===n(r(e,o),r(t,o)))return!1;return!0}function a(e,t){let i=t.length,o=i-e.length;if(o<0)return!1;for(let a=i-1;a>=o;a--)if(!1===n(r(e,a-o),r(t,a)))return!1;return!0}function s(e,t){let i=e.length;if(t.length<i)return!1;for(let o=0;o<i;o++)if(!1===n(r(e,o),r(t,o)))return!1;return!0}const l="Function";function u(e,t,i){let r=e.value.children.first;return o(t,e.property)&&"Identifier"===r.type&&o(i,r.name)}function f(e){let i=!1;return t(e,function(e){if("Declaration"===e.type&&(u(e,"-webkit-appearance","none")||u(e,"-moz-appearance","meterbar")))return i=!0,this.break}),i}function c(e){let i=!1;return t(e,function(e){let t=e.children,r=e.name,n=e.value;if("MediaQuery"===e.type&&1===t.size&&"Identifier"===t.first.type){let e=t.first.name;if(s("\\0",e)||a("\\9 ",e))return i=!0,this.break}if("MediaFeature"===e.type){if(null!==n&&"\\0"===n.unit)return i=!0,this.break;if(o("-moz-images-in-menus",r)||o("min--moz-device-pixel-ratio",r)||o("-ms-high-contrast",r))return i=!0,this.break;if(o("min-resolution",r)&&o(".001",n.value)&&o("dpcm",n.unit))return i=!0,this.break;if(o("-webkit-min-device-pixel-ratio",r)){let e=n.value;if(o("0",e)||o("10000",e))return i=!0,this.break}}}),i}function h(e){return 45===e.charCodeAt(0)&&45!==e.charCodeAt(1)&&-1!==e.indexOf("-",2)}function m(e,i){let r=[];return t(e,{visit:"Selector",enter:function(e){r.push(i(e))}}),r}function d(e){return o(e,"not")||o(e,"nth-child")||o(e,"nth-last-child")||o(e,"where")||o(e,"is")||o(e,"has")||o(e,"matches")||o(e,"-webkit-any")||o(e,"-moz-any")}function w(e){let i=!1;return t(e,function(e){if("AttributeSelector"===e.type){let t=e.name.name;if(o("role",t)||s("aria-",t))return i=!0,this.break}else if("PseudoClassSelector"===e.type&&d(e.name))return m(e,w).some(e=>!0===e)?(i=!0,this.skip):this.skip}),i}function p(e){let i=!1;return t(e,function(e){if("IdSelector"===e.type||"ClassSelector"===e.type||"PseudoElementSelector"===e.type||"TypeSelector"===e.type||"PseudoClassSelector"===e.type){if(h(e.name))return i=!0,this.break}else if("AttributeSelector"===e.type&&h(e.name.name))return i=!0,this.break}),i}function b(e){let i=0;return t(e,function(e){if("Selector"!==e.type&&"Nth"!==e.type){if(i++,"IdSelector"!==e.type&&"ClassSelector"!==e.type&&"PseudoElementSelector"!==e.type&&"TypeSelector"!==e.type&&"PseudoClassSelector"!==e.type||h(e.name)&&i++,"AttributeSelector"===e.type)return Boolean(e.value)&&i++,h(e.name.name)&&i++,this.skip;if("PseudoClassSelector"===e.type&&d(e.name)){let t=m(e,b);if(0===t.length)return;return t.forEach(e=>{i+=e}),this.skip}}}),i}class g{constructor(e){this.set=e}has(e){let t=this.set.length;for(let i=0;i<t;i++)if(o(this.set[i],e))return!0;return!1}}const k=new g(["white","black","red","blue","gray","grey","green","rebeccapurple","yellow","orange","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","blanchedalmond","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","whitesmoke","yellowgreen"]),y=new g(["canvas","canvastext","linktext","visitedtext","activetext","buttonface","buttontext","buttonborder","field","fieldtext","highlight","highlighttext","selecteditem","selecteditemtext","mark","marktext","graytext"]),v=new g(["rgb","rgba","hsl","hsla","hwb","lab","lch","oklab","oklch","color"]),x=new g(["transparent","currentcolor"]),q=new g(["caption","icon","menu","message-box","small-caption","status-bar"]),S=new g(["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large","smaller","larger"]);function z(e,t){return e.charCodeAt(t)}function C(e){let t=e.children.first;return null!==t&&"Identifier"===t.type&&q.has(t.name)}const O=new g(["auto","inherit","initial","unset","revert","revert-layer","none"]);function _(e){let t=e.children,i=t.size;if(!t)return!1;if(i>1||0===i)return!1;let r=t.first;return"Identifier"===r.type&&O.has(r.name)}const I=new g(["linear","ease","ease-in","ease-out","ease-in-out","step-start","step-end"]),D=new g(["cubic-bezier","steps"]);function P(e){let t=e.children;if(!t)return!1;let i=t.toArray();for(let e=0;e<i.length;e++){let t=i[e],{type:r,name:n}=t;if("Identifier"===r&&h(n))return!0;if(r===l){if(h(n))return!0;if(P(t))return!0}}return!1}class M{constructor(e=!1){this.t=new Map,this.i=0,e&&(this.o=[],this.l=[],this.u=[],this.h=[]),this.m=e}p(e,t){let i=this.i;if(this.m){let e=t.start,r=e.offset;this.o[i]=e.line,this.l[i]=e.column,this.h[i]=r,this.u[i]=t.end.offset-r}if(this.t.has(e))return this.t.get(e).push(i),void this.i++;this.t.set(e,[i]),this.i++}size(){return this.i}c(){let e=this.m,t=new Map,i={},r=this.t,n=r.size;return r.forEach((r,n)=>{if(e){let e=r.map(e=>({line:this.o[e],column:this.l[e],offset:this.h[e],length:this.u[e]}));t.set(n,e)}i[n]=r.length}),this.m?{total:this.i,totalUnique:n,unique:i,uniquenessRatio:0===this.i?0:n/this.i,__unstable__uniqueWithLocations:Object.fromEntries(t)}:{total:this.i,totalUnique:n,unique:i,uniquenessRatio:0===this.i?0:n/this.i}}}class U{constructor(e){this.g=new M(e),this.k=new Map,this.m=e}push(e,t,i){this.g.p(e,i),this.k.has(t)||this.k.set(t,new M(this.m)),this.k.get(t).p(e,i)}count(){let e=new Map;for(let[t,i]of this.k.entries())e.set(t,i.c());return Object.assign(this.g.c(),{itemsPerContext:Object.fromEntries(e)})}}class j{constructor(){this.t=[],this.v=0}push(e){this.t.push(e),this.v+=e}size(){return this.t.length}aggregate(){let e=this.t.length;if(0===e)return{min:0,max:0,mean:0,mode:0,median:0,range:0,sum:0};let t=this.t.slice().sort((e,t)=>e-t),i=t[0],r=t[e-1],n=function(e){let t=new Map,i=-1,r=0,n=0,o=e.length;for(let a=0;a<o;a++){let o=e[a],s=(t.get(o)||0)+1;t.set(o,s),s>i&&(i=s,r=0,n=0),s>=i&&(r++,n+=o)}return n/r}(t),o=function(e){let t=e.length/2,i=Math.floor(t);return t!==i?e[i]:(e[i]+e[i-1])/2}(t),a=this.v;return{min:i,max:r,mean:a/e,mode:n,median:o,range:r-i,sum:a}}toArray(){return this.t}}function A(e){if(R(e)||h(e))return!1;let t=e.charCodeAt(0);return 47===t||95===t||43===t||42===t||38===t||36===t||35===t}function R(e){return!(e.length<3)&&45===e.charCodeAt(0)&&45===e.charCodeAt(1)}function F(e,t){return!R(t)&&a(e,t)}function T(e){let t=e.children;if(t){let e=t.last;return e&&"Identifier"===e.type&&a("\\9",e.name)}return!1}function H(e,t){return T(e)||"string"==typeof t}function L(e,t){return 0===t?0:e/t}let B={useUnstableLocations:!1};function E(r,n={}){let u=!0===Object.assign({},B,n).useUnstableLocations,m=Date.now();function d(e){return g(e).trim()}function g(e){let t=e.loc;return r.substring(t.start.offset,t.end.offset)}let q,O,H=0,E=0,V=new M(u),K=0,Q={total:0,unique:new Map},W=Date.now(),G=e(r,{parseCustomProperty:!0,positions:!0,onComment:function(e){H++,E+=e.length}}),J=Date.now(),X=G.loc.end.line-G.loc.start.line+1,Y=0,Z=[],$=new M(u),ee=new M(u),te=new M(u),ie=new M(u),re=new M(u),ne=new M(u),oe=new M(u),ae=new M(u),se=new M(u),le=new M(u),ue=new M(u),fe=0,ce=0,he=new j,me=new j,de=new j,we=new M(u),pe=new M(u),be=new M(u),ge=new M(u),ke=new Set,ye=new M(u),ve=new j,xe=new j,qe=new j,Se=new M(u),ze=new j,Ce=new M(u),Oe=[],_e=new M(u),Ie=new M(u),De=new M(u),Pe=new Set,Me=0,Ue=0,je=0,Ae=new M(u),Re=new M(u),Fe=new M(u),Te=new M(u),He=new M(u),Le=new j,Be=new M(u),Ee=new M(u),Ne=new M(u),Ve=new M(u),Ke=new M(u),Qe=new M(u),We=new M(u),Ge=new M(u),Je=new M(u),Xe=new M(u),Ye=new U(u),Ze=new M(u),$e=new U(u),et=new M(u);t(G,function(e){switch(e.type){case"Atrule":{Y++;let t=e.name;if("font-face"===t){let t={};e.block.children.forEach(e=>{"Declaration"===e.type&&(t[e.property]=d(e.value))}),Z.push(t);break}if(null!==e.prelude){let i=e.prelude,r=i&&d(e.prelude),n=i.loc;if("media"===t){te.p(r,n),c(i)&&ie.p(r,n);break}if("supports"===t){ne.p(r,n),f(i)&&oe.p(r,n);break}if(a("keyframes",t)){let e="@"+t+" "+r;h(t)&&se.p(e,n),ae.p(e,n);break}if("import"===t){ee.p(r,n);break}if("charset"===t){re.p(r,n);break}if("container"===t){le.p(r,n);break}if("layer"===t){r.split(",").forEach(e=>$.p(e.trim(),n));break}if("property"===t){ue.p(r,n);break}}break}case"Rule":{let t=e.prelude,i=e.block,r=t.children,n=i.children,o=r?r.size:0,a=n?n.size:0;he.push(o+a),we.p(o+a,e.loc),me.push(o),pe.p(o,t.loc),de.push(a),be.p(a,i.loc),fe++,0===a&&ce++;break}case"Selector":{let r=d(e);if(this.atrule&&a("keyframes",this.atrule.name))return ge.p(r,e.loc),this.skip;w(e)&&Ie.p(r,e.loc);let n=b(e);p(e)&&ye.p(r,e.loc),ke.add(r),ze.push(n),Ce.p(n,e.loc);let[{value:o}]=i(e),s=o.a,l=o.b,u=o.c,f=[s,l,u];return Se.p(s+","+l+","+u,e.loc),ve.push(s),xe.push(l),qe.push(u),void 0===q&&(q=f),void 0===O&&(O=f),void 0!==O&&N(O,f)<0&&(O=f),void 0!==q&&N(q,f)>0&&(q=f),Oe.push(f),s>0&&_e.p(r,e.loc),function(e,i){t(e,function(e,t){if("Combinator"===e.type){let r=e.loc,n=e.name;if(null===r){let e=t.prev.data.loc.end,r={offset:e.offset,line:e.line,column:e.column};i({name:n,loc:{start:r,end:{offset:r.offset+1,line:r.line,column:r.column+1}}})}else i({name:n,loc:r})}})}(e,function(e){De.p(e.name,e.loc)}),this.skip}case"Dimension":{if(!this.declaration)break;let t=e.unit;return a("\\9",t)?$e.push(t.substring(0,t.length-2),this.declaration.property,e.loc):$e.push(t,this.declaration.property,e.loc),this.skip}case"Url":if(s("data:",e.value)){let t=e.value,i=t.length,r=function(e){let t=e.indexOf(";"),i=e.indexOf(",");return e.substring(5,-1===t||-1!==i&&i<t?i:t)}(t);if(Q.total++,K+=i,Q.unique.has(r)){let e=Q.unique.get(r);e.count++,e.size+=i,Q.unique.set(r,e)}else Q.unique.set(r,{count:1,size:i});V.p(t,e.loc)}break;case"Value":{if(_(e))break;let i=this.declaration,{property:r,important:n}=i;P(e)&&Be.p(d(e),e.loc),"string"==typeof n&&Ee.p(g(e)+"!"+n,e.loc),T(e)&&Ee.p(d(e),e.loc);let s=e.children,u=e.loc;if(F("z-index",r))return Ne.p(d(e),u),this.skip;if(F("font",r)){if(C(e))return;let{font_size:t,line_height:i,font_family:r}=function(e,t){let i,r,n=new Array(2);return e.children.forEach(function(e,o){if(o.next&&"Operator"===o.next.data.type&&47===z(o.next.data.value,0))i=t(e);else if(o.prev&&"Operator"===o.prev.data.type&&47===z(o.prev.data.value,0))r=t(e);else{if(o.next&&"Operator"===o.next.data.type&&44===z(o.next.data.value,0)&&!n[0])return n[0]=e,void(i||null==o.prev||(i=t(o.prev.data)));if("Number"!==e.type){if(null===o.next)return n[1]=e,void(i||n[0]||!o.prev||(i=t(o.prev.data)));if("Identifier"===e.type){let t=e.name;if(S.has(t))return void(i=t)}}}}),{font_size:i,line_height:r,font_family:n[0]||n[1]?t({loc:{start:{offset:(n[0]||n[1]).loc.start.offset},end:{offset:n[1].loc.end.offset}}}):null}}(e,d);r&&Qe.p(r,u),t&&We.p(t,u),i&&Ge.p(i,u);break}if(F("font-size",r)){C(e)||We.p(d(e),u);break}if(F("font-family",r)){C(e)||Qe.p(d(e),u);break}if(F("line-height",r))Ge.p(d(e),u);else{if(F("transition",r)||F("animation",r)){let[e,t]=function(e,t){let i=!1,r=[],n=[];return e.forEach(e=>{let o=e.type,a=e.name;return"Operator"===o?i=!1:"Dimension"===o&&!1===i?(i=!0,r.push(t(e))):"Identifier"===o&&I.has(a)||o===l&&D.has(a)?n.push(t(e)):void 0}),[r,n]}(s,d);for(let t=0;t<e.length;t++)Xe.p(e[t],u);for(let e=0;e<t.length;e++)Je.p(t[e],u);break}if(F("animation-duration",r)||F("transition-duration",r)){s&&s.size>1?s.forEach(e=>{"Operator"!==e.type&&Xe.p(d(e),u)}):Xe.p(d(e),u);break}if(F("transition-timing-function",r)||F("animation-timing-function",r)){s&&s.size>1?s.forEach(e=>{"Operator"!==e.type&&Je.p(d(e),u)}):Je.p(d(e),u);break}F("text-shadow",r)?_(e)||Ve.p(d(e),u):F("box-shadow",r)&&(_(e)||Ke.p(d(e),u))}t(e,function(e){let t=e.name;switch(e.type){case"Hash":{let t=e.value.length;return a("\\9",e.value)&&(t-=2),Ye.push("#"+e.value,r,u),Ze.p("hex"+t,u),this.skip}case"Identifier":{let i=t.length;if(i>20||i<3)return this.skip;if(k.has(t)){let t=d(e);return Ye.push(t,r,u),void Ze.p("named",u)}if(x.has(t)){let i=d(e);return Ye.push(i,r,u),void Ze.p(t.toLowerCase(),u)}if(y.has(t)){let t=d(e);return Ye.push(t,r,u),void Ze.p("system",u)}return this.skip}case l:if(o("var",t))return this.skip;if(v.has(t))return Ye.push(d(e),r,e.loc),void Ze.p(t.toLowerCase(),e.loc);if(a("gradient",t))return void et.p(d(e),e.loc)}});break}case"Declaration":{if(null!==this.atrulePrelude)return this.skip;Me++,Pe.add(d(e)),!0===e.important&&(Ue++,this.atrule&&a("keyframes",this.atrule.name)&&je++);let{property:t,loc:{start:i}}=e,r={start:{line:i.line,column:i.column,offset:i.offset},end:{offset:i.offset+t.length}};Re.p(t,r),h(t)?(Te.p(t,r),Le.push(2)):A(t)?(Fe.p(t,r),Le.push(2)):R(t)?(He.p(t,r),Le.push(2),!0===e.important&&Ae.p(t,r)):Le.push(1);break}}});let tt=V.c(),it=Pe.size,rt=ze.size(),nt=ve.aggregate(),ot=xe.aggregate(),at=qe.aggregate(),st=ke.size,lt=Object.assign,ut=r.length,ft=Z.length;return{stylesheet:{sourceLinesOfCode:Y+rt+Me+ge.size(),linesOfCode:X,size:ut,comments:{total:H,size:E},embeddedContent:lt(tt,{size:{total:K,ratio:L(K,ut)},types:{total:Q.total,totalUnique:Q.unique.size,uniquenessRatio:L(Q.unique.size,Q.total),unique:Object.fromEntries(Q.unique)}})},atrules:{fontface:{total:ft,totalUnique:ft,unique:Z,uniquenessRatio:0===ft?0:1},import:ee.c(),media:lt(te.c(),{browserhacks:ie.c()}),charset:re.c(),supports:lt(ne.c(),{browserhacks:oe.c()}),keyframes:lt(ae.c(),{prefixed:lt(se.c(),{ratio:L(se.size(),ae.size())})}),container:le.c(),layer:$.c(),property:ue.c()},rules:{total:fe,empty:{total:ce,ratio:L(ce,fe)},sizes:lt(he.aggregate(),{items:he.toArray()},we.c()),selectors:lt(me.aggregate(),{items:me.toArray()},pe.c()),declarations:lt(de.aggregate(),{items:de.toArray()},be.c())},selectors:{total:rt,totalUnique:st,uniquenessRatio:L(st,rt),specificity:lt({min:void 0===O?[0,0,0]:O,max:void 0===q?[0,0,0]:q,sum:[nt.sum,ot.sum,at.sum],mean:[nt.mean,ot.mean,at.mean],mode:[nt.mode,ot.mode,at.mode],median:[nt.median,ot.median,at.median],items:Oe},Se.c()),complexity:lt(ze.aggregate(),Ce.c(),{items:ze.toArray()}),id:lt(_e.c(),{ratio:L(_e.size(),rt)}),accessibility:lt(Ie.c(),{ratio:L(Ie.size(),rt)}),keyframes:ge.c(),prefixed:lt(ye.c(),{ratio:L(ye.size(),rt)}),combinators:De.c()},declarations:{total:Me,totalUnique:it,uniquenessRatio:L(it,Me),unique:{total:it,ratio:L(it,Me)},importants:{total:Ue,ratio:L(Ue,Me),inKeyframes:{total:je,ratio:L(je,Ue)}}},properties:lt(Re.c(),{prefixed:lt(Te.c(),{ratio:L(Te.size(),Re.size())}),custom:lt(He.c(),{ratio:L(He.size(),Re.size()),importants:lt(Ae.c(),{ratio:L(Ae.size(),He.size())})}),browserhacks:lt(Fe.c(),{ratio:L(Fe.size(),Re.size())}),complexity:Le.aggregate()}),values:{colors:lt(Ye.count(),{formats:Ze.c()}),gradients:et.c(),fontFamilies:Qe.c(),fontSizes:We.c(),lineHeights:Ge.c(),zindexes:Ne.c(),textShadows:Ve.c(),boxShadows:Ke.c(),animations:{durations:Xe.c(),timingFunctions:Je.c()},prefixes:Be.c(),browserhacks:Ee.c(),units:$e.count()},__meta__:{parseTime:J-W,analyzeTime:Date.now()-J,total:Date.now()-m}}}function N(e,t){return e[0]===t[0]?e[1]===t[1]?t[2]-e[2]:t[1]-e[1]:t[0]-e[0]}export{E as analyze,N as compareSpecificity,h as hasVendorPrefix,w as isAccessibilitySelector,c as isMediaBrowserhack,A as isPropertyHack,p as isSelectorPrefixed,f as isSupportsBrowserhack,H as isValueBrowserhack,P as isValuePrefixed,b as selectorComplexity};
//# sourceMappingURL=analyzer.modern.js.map
